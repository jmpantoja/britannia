{% extends '@SonataAdmin/Form/form_admin_fields.html.twig' %}

{% block form_row %}
    {% set show_label = show_label ?? true %}
    <fieldset class="form-group{% if errors|length > 0 %} has-error{% endif %}" id="sonata-ba-field-container-{{ id }}">
        {% if sonata_admin.field_description.options is defined %}
            {% set label = sonata_admin.field_description.options.name|default(label) %}
        {% endif %}

        {% set div_class = 'sonata-ba-field' %}

        {% if label is same as(false) %}
            {% set div_class = div_class ~ ' sonata-collection-row-without-label' %}
        {% endif %}

        {% if sonata_admin is defined and sonata_admin.options['form_type'] == 'horizontal' %}
            {# Add an offset if no label or is a checkbox/radio #}
            {% if label is same as(false) or form.vars.checked is defined %}
                {% if 'collection' in form.parent.vars.block_prefixes %}
                    {% set div_class = div_class ~ ' col-sm-12' %}
                {% else %}
                    {% set div_class = div_class ~ ' col-sm-9 col-sm-offset-3' %}
                {% endif %}
            {% else %}
                {% set div_class = div_class ~ ' col-sm-9' %}
            {% endif %}
        {% endif %}

        {% if show_label %}
            {{ form_label(form, label|default(null)) }}
        {% endif %}

        {% if sonata_help is defined and sonata_help %}
            <span class="help-block sonata-ba-field-widget-help">
                    {#<i class="fa fa-question-circle-o" aria-hidden="true"></i>#}
                {{ sonata_help|raw }}
                </span>
        {% endif %}

        {% if sonata_admin is defined and sonata_admin_enabled %}
            {% set div_class = div_class ~ ' sonata-ba-field-' ~ sonata_admin.edit ~ '-' ~ sonata_admin.inline %}
        {% endif %}

        {% if errors|length > 0 %}
            {% set div_class = div_class ~ ' sonata-ba-field-error' %}
        {% endif %}

        <div class="{{ div_class }}">
            {{ form_widget(form, {'horizontal': false, 'horizontal_input_wrapper_class': ''}) }}

            {% if errors|length > 0 %}
                <div class="help-block sonata-ba-field-error-messages">
                    {{ form_errors(form) }}
                </div>
            {% endif %}

            {% if sonata_admin is defined and sonata_admin_enabled and sonata_admin.field_description.help|default(false) %}
                <span class="help-block sonata-ba-field-help">{{ sonata_admin.field_description.help|trans({}, sonata_admin.field_description.translationDomain ?: admin.translationDomain)|raw }}</span>
            {% endif %}
        </div>
    </fieldset>


{% endblock form_row %}

{% block sonata_help %}
{% endblock %}

{% block form_label %}
    {% apply spaceless %}
        {% if label is not same as(false) and sonata_admin.options['form_type'] == 'horizontal' %}
            {% set label_class = 'col-sm-3' %}
        {% endif %}

        {% set label_class = label_class|default('') ~ ' control-label' %}

        {% if label is not same as(false) %}
            {% set label_attr = label_attr|merge({'class': label_attr.class|default('') ~ ' ' ~ label_class }) %}

            {% if not compound %}
                {% set label_attr = label_attr|merge({'for': id}) %}
            {% endif %}
            {% if required %}
                {% set label_attr = label_attr|merge({'class': (label_attr.class|default('') ~ ' required')|trim}) %}
            {% endif %}

            {% if label is empty %}
                {%- if label_format is defined and label_format is not empty -%}
                    {% set label = label_format|replace({
                        '%name%': name,
                        '%id%': id,
                    }) %}
                {%- else -%}
                    {% set label = name|humanize %}
                {%- endif -%}
            {% endif %}



            {% if not compound %}

                <label{% for attrname, attrvalue in label_attr %} {{ attrname }}="{{ attrvalue }}"{% endfor %}>
                {% if translation_domain is same as(false) %}
                    {{- label -}}
                {% elseif not sonata_admin.admin %}
                    {{- label|trans({}, translation_domain) -}}
                {% else %}
                    {{ label|trans({}, sonata_admin.field_description.translationDomain ?: admin.translationDomain) }}
                {% endif %}
                </label>



            {% else %}

                <legend{% for attrname, attrvalue in label_attr %} {{ attrname }}="{{ attrvalue }}"{% endfor %}>
                {% if translation_domain is same as(false) %}
                    {{- label -}}
                {% elseif not sonata_admin.admin %}
                    {{- label|trans({}, translation_domain) -}}
                {% else %}
                    {{ label|trans({}, sonata_admin.field_description.translationDomain ?: admin.translationDomain) }}
                {% endif %}
                </legend>

            {% endif %}

        {% endif %}
    {% endapply %}
{% endblock form_label %}

